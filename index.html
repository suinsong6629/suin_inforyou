<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¯¸ë˜ì „ëµ ì‚¬ì—…ë‹¨ V8</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum:wght@400;700&display=swap');
        :root { --primary: #3b82f6; --bg: #f0f4f8; --card: #ffffff; --border: #e2e8f0; --red: #ef4444; --green: #34C759; --gray: #475569; }
        * { font-family: 'Gowun Dodum', sans-serif !important; box-sizing: border-box; }
        body { background-color: var(--bg); display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; margin: 0; padding: 40px 20px; color: #334155; }
        
        /* Layout */
        .weather-sidebar, .sidebar { position: fixed; top: 100px; width: 200px; z-index: 1000; }
        .weather-sidebar { left: 30px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px); padding: 20px; border-radius: 24px; box-shadow: 0 8px 25px rgba(0,0,0,0.05); }
        .sidebar { right: 30px; width: 180px; display: flex; flex-direction: column; gap: 12px; }
        
        /* Dashboard & Forecast */
        .date-text { font-size: 12px; color: #64748b; margin-bottom: 5px; }
        .time-text { font-size: 22px; font-weight: 700; color: var(--primary); margin-bottom: 15px; }
        .weather-main { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-weight: 700; }
        #weather-desc { font-size: 12px; color: #94a3b8; text-align: right; margin-bottom: 15px; }
        .hourly-forecast { display: flex; flex-direction: column; gap: 10px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.05); }
        .forecast-item { display: flex; align-items: center; justify-content: space-between; font-size: 12px; }
        
        /* Sidebar Buttons */
        .side-btn { padding: 16px 12px; border-radius: 16px; text-decoration: none; font-size: 14px; font-weight: 700; color: white; text-align: center; box-shadow: 0 6px 15px rgba(0,0,0,0.1); transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .side-btn:hover { transform: translateX(-8px); filter: brightness(1.1); }
        .bg-erp { background-color: #6366f1; } .bg-gap { background-color: #f59e0b; } .bg-green { background-color: var(--green); } .bg-blue { background-color: #1e40af; }
        
        /* Main Container */
        .container { width: 100%; max-width: 700px; background: var(--card); padding: 40px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); margin-bottom: 40px; }
        h1 { font-weight: 700; color: var(--primary); text-align: center; font-size: 28px; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 30px; }
        .input-group { padding: 20px; border: 1px solid #f1f5f9; border-radius: 18px; }
        .section-title { font-size: 15px; font-weight: 700; margin-bottom: 15px; color: #000; }
        label { display: block; margin-bottom: 5px; font-size: 13px; font-weight: 700; }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; margin-bottom: 12px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: var(--primary); }
        .btn-primary { width: 100%; padding: 20px; border: none; border-radius: 15px; font-size: 18px; cursor: pointer; background: var(--primary); color: white; font-weight: 700; transition: 0.3s; }
        .btn-primary:hover { filter: brightness(1.05); transform: translateY(-2px); }
        
        /* Calendar */
        .calendar-section { margin-top: 40px; border-top: 2px dashed #f1f5f9; padding-top: 30px; }
        .calendar-header h2 { font-weight: 700; font-size: 22px; color: var(--gray); text-align: center; margin-bottom: 20px; }
        .calendar-table { width: 100%; border-collapse: separate; border-spacing: 4px; table-layout: fixed; }
        .calendar-table th { color: #94a3b8; font-size: 12px; padding: 10px; font-weight: 400; }
        .calendar-table td { height: 95px; vertical-align: top; padding: 8px; background: #fff; border: 1px solid #f8fafc; border-radius: 12px; }
        .day-num { font-weight: 400; margin-bottom: 6px; display: block; color: #64748b; }
        .today { background-color: #f0f7ff !important; border: 1px solid #dbeafe !important; }
        .today .day-num { color: var(--primary); font-weight: 700; }
        .event-item { display: flex; align-items: flex-start; font-size: 11px; color: var(--gray); line-height: 1.4; margin-top: 4px; word-break: keep-all; }
        .event-star { color: var(--red); font-size: 10px; margin-right: 4px; margin-top: 2px; }
        
        #status { text-align: center; margin-top: 15px; font-size: 13px; min-height: 20px; }
        .footer { text-align: center; margin-top: 30px; font-size: 13px; color: #cbd5e1; }

        @media (max-width: 1250px) {
            body { align-items: center; padding-top: 20px; }
            .weather-sidebar, .sidebar { position: static; width: 100%; max-width: 700px; margin-bottom: 15px; }
            .sidebar { flex-direction: row; flex-wrap: wrap; } .side-btn { flex: 1 1 45%; font-size: 12px; }
            .hourly-forecast { flex-direction: row; overflow-x: auto; } .forecast-item { flex-direction: column; min-width: 60px; }
        }
    </style>
</head>
<body>

<div class="weather-sidebar">
    <div class="dash-left"><div id="cur-date" class="date-text"></div><div id="cur-time" class="time-text"></div></div>
    <div class="weather-main"><span>ì„œìš¸</span><span id="we-temp">--Â°C</span></div>
    <div id="weather-desc">ë‚ ì”¨ í™•ì¸ ì¤‘...</div>
    <div class="hourly-forecast" id="forecast"></div>
</div>

<div class="sidebar">
    <a href="https://infis-erp.co.kr/" target="_blank" class="side-btn bg-erp">ğŸ’» ERP ë°”ë¡œê°€ê¸°</a>
    <a href="http://chrurck.com/?act=info.page&pcode=sub1_3" target="_blank" class="side-btn bg-gap">âš¡ ì´ˆê²©ì°¨ë³´í—˜</a>
    <a href="https://pcs.iaa.or.kr/comm/login.do" target="_blank" class="side-btn bg-green">âœ” ë¹„êµí™•ì¸ì„œ</a>
    <a href="https://www.mohom.kr/" target="_blank" class="side-btn bg-blue">ğŸ  ëª¨í™ˆ (ì²­êµ¬)</a>
</div>

<div class="container">
    <h1>ğŸ¢ ë¯¸ë˜ì „ëµ ì‚¬ì—…ë‹¨</h1>
    <div class="grid">
    <div class="input-group">
        <div class="section-title">ğŸ“‚ ì–‘ì‹ íŒŒì¼ ìœ ì§€</div>
        
        <label>ê³ ì§€ì˜ë¬´ ì´í–‰í™•ì¸ì„œ</label>
        <input type="file" id="f1" accept=".pdf" onchange="keepFile(1)">
        <div id="f1-msg" style="display:none; color:var(--green); font-size:11px; margin-bottom:10px;">âœ“ ë¡œë“œì™„ë£Œ</div>
        
        <label>í•„ìˆ˜ ë™ì˜ì„œ</label>
        <input type="file" id="f2" accept=".pdf" onchange="keepFile(2)">
        <div id="f2-msg" style="display:none; color:var(--green); font-size:11px; margin-bottom:10px;">âœ“ ë¡œë“œì™„ë£Œ</div>

        <div style="position: relative; margin-top: 15px; border: 1px dashed var(--border); padding: 10px; border-radius: 12px; overflow: hidden;">
            <div style="filter: blur(2px); pointer-events: none; user-select: none;">
                <label>ë¹„êµí™•ì¸ì•ˆë‚´ì„œ</label>
                <input type="file" id="f3" accept=".pdf">
                
                <label>ë³´í—˜ì‚¬ ì„ íƒ</label>
                <select id="selCompany"><option>ë°ì´í„° ë¡œë”© ì¤‘...</option></select>
                
                <label>ìƒí’ˆ ì„ íƒ</label>
                <select id="selProduct"><option>ë°ì´í„° ë¡œë”© ì¤‘...</option></select>
            </div>
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.4); z-index: 2;">
                <span style="background: var(--primary); color: white; padding: 5px 15px; border-radius: 20px; font-size: 13px; font-weight: 700; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">ğŸ› ï¸ ì‹œíŠ¸ ì—°ë™ ì¤€ë¹„ ì¤‘</span>
            </div>
        </div>
    </div>

    <div class="input-group">
        <div class="section-title">ğŸ‘¤ ê¸°ì¬ ì •ë³´</div>
        <label>ê³„ì•½ ì²´ê²°ì¼</label><input type="date" id="cDate">
        <label>ë‹´ë‹¹ ì„¤ê³„ì‚¬</label><input type="text" id="pName" placeholder="ì„¤ê³„ì‚¬ ì„±í•¨">
        <label>ê³„ì•½ì ì„±ëª…</label><input type="text" id="uName" placeholder="ì„±í•¨ ì…ë ¥">
    </div>
</div>
    <button class="btn-primary" onclick="startProcess()">ğŸ“¤ ì„œë¥˜ ìƒì„± ë° ë“œë¼ì´ë¸Œ ì „ì†¡</button>
    <div id="status"></div>
    <div class="calendar-section"><div class="calendar-header"><h2 id="cal-title"></h2></div><table class="calendar-table" id="cal-body"><thead><tr><th style="color:var(--red)">ì¼</th><th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th style="color:var(--primary)">í† </th></tr></thead><tbody></tbody></table></div>
    <div class="footer">ëª¨ë‘ ê°ê¸° ì¡°ì‹¬! Â© 2026 ë¯¸ë˜ì „ëµ ì‚¬ì—…ë‹¨</div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    const API_KEY = 'e9e4b4788a9cb01857b3d430b6551c24';
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwi2Cc3n57UaOUPsZAijahVbM5GB0p0IRVL9VR8EzqyYpNMcT7tgiLVwI6Qcv5gZtWFBg/exec';
    
    const eventData = {
        '2026-01-01': ['ì‹ ì •'], '2026-01-02': ['ì „ì²´ë¯¸íŒ…'],
        '2026-01-16': ['ìˆ˜ì¸ íœ´ê°€'], '2026-01-19': ['í•˜ê²½ íœ´ê°€'], '2026-01-23': ['ìˆ˜ì¸ íœ´ê°€'],
        '2026-01-26': ['í•˜'], '2026-01-27': ['ê²½'], '2026-01-28': ['íœ´'], '2026-01-29': ['-'],
        '2026-01-30': ['ê°€'],'2026-01-31': ['í•˜ê²½í‡´ì‚¬']
    };

    const $ = id => document.getElementById(id);
    const pad = n => String(n).padStart(2, '0');

    function updateClock() {
        const n = new Date();
        const days = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
        let h = n.getHours();
        const ampm = h >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';
        h = h % 12 || 12;
        $('cur-date').innerText = `${n.getFullYear()}.${n.getMonth()+1}.${n.getDate()}(${days[n.getDay()]})`;
        $('cur-time').innerText = `${ampm} ${h}:${pad(n.getMinutes())}`;
    }

    async function fetchWeather() {
        try {
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Seoul&appid=${API_KEY}&units=metric&lang=kr`);
            const d = await res.json();
            const temp = Math.round(d.main.temp);
            $('we-temp').innerText = `${temp}Â°C`;
            $('weather-desc').innerText = d.weather[0].description;
            
            const iconMap = { '01':'â˜€ï¸','02':'ğŸŒ¤ï¸','03':'â˜ï¸','04':'â˜ï¸','09':'ğŸŒ§ï¸','10':'ğŸŒ¦ï¸','11':'âš¡','13':'â„ï¸','50':'ğŸŒ«ï¸' };
            const emoji = iconMap[d.weather[0].icon.substring(0,2)] || 'â˜€ï¸';
            
            let hHtml = '';
            const curH = new Date().getHours();
            for(let i=0; i<6; i++) {
                const h = (curH + i) % 24;
                hHtml += `<div class="forecast-item"><span>${i===0?'ì§€ê¸ˆ':(h>=12?'ì˜¤í›„ ':'ì˜¤ì „ ')+(h%12||12)+'ì‹œ'}</span><span>${emoji}</span><span style="width:30px; text-align:right">${temp}Â°</span></div>`;
            }
            $('forecast').innerHTML = hHtml;
        } catch (e) { $('weather-desc').innerText = "ë‚ ì”¨ í™œì„±í™” ëŒ€ê¸° ì¤‘"; }
    }

    function drawCal() {
        const n = new Date();
        const y = 2026, m = 0;
        $('cal-title').innerText = `${y}ë…„ ${m + 1}ì›”`;
        const start = new Date(y, m, 1).getDay();
        const end = new Date(y, m + 1, 0).getDate();
        let html = '<tr>', date = 1;

        for(let i=0; i<42; i++) {
            if (i > 0 && i % 7 === 0) html += '</tr><tr>';
            if (i < start || date > end) html += '<td></td>';
            else {
                const key = `${y}-${pad(m+1)}-${pad(date)}`;
                const isToday = (date === n.getDate() && m === n.getMonth() && n.getFullYear() === y) ? 'today' : '';
                let evHtml = '';
                if(eventData[key]) eventData[key].forEach(t => evHtml += `<div class="event-item"><span class="event-star">â˜…</span>${t}</div>`);
                html += `<td class="${isToday}"><span class="day-num">${date}</span>${evHtml}</td>`;
                date++;
            }
            if (date > end && (i+1) % 7 === 0) break;
        }
        document.querySelector('#cal-body tbody').innerHTML = html + '</tr>';
    }

    let files = [null, null, null];
    function keepFile(n) { 
        const f = $('f'+n).files[0]; 
        if(f){ 
            files[n-1]=f; 
            $('f'+n+'-msg').style.display='block'; 
        } 
    }

    async function startProcess() {
        const d = $('cDate').value, n = $('uName').value, p = $('pName').value;
        if (!files[0] || !files[1] || !d || !n || !p) return alert("í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        
        const st = $('status'); st.style.color = "var(--primary)"; st.innerText = "âœ¨ ì „ì†¡ ì¤‘...";
        try {
            const dt = new Date(d);
            const dy = { y: dt.getFullYear().toString().slice(-2), m: (dt.getMonth()+1).toString(), day: dt.getDate().toString() };
            
            const i1 = await render(files[0], "ê³ ", dy, n, p);
            const i2 = await render(files[1], "ë™", dy, n, p);
            
            const payload = { file1Data: i1, fileName1: `${n}_ê³ .jpg`, file2Data: i2, fileName2: `${n}_ë™.jpg` };
            
            // 3ë²ˆ íŒŒì¼(ë¹„êµì•ˆë‚´í‘œ)ì´ ì—…ë¡œë“œ ë˜ì—ˆì„ ê²½ìš°ì—ë§Œ ì „ì†¡ ë°ì´í„°ì— ì¶”ê°€
            if(files[2]) {
                const i3 = await render(files[2], "ë¹„", dy, n, p);
                payload.file3Data = i3;
                payload.fileName3 = `${n}_ë¹„.jpg`;
            }

            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            st.style.color = "var(--green)"; st.innerText = "âœ… ì „ì†¡ ì™„ë£Œ!";
        } catch (e) { st.style.color = "var(--red)"; st.innerText = "âŒ ì „ì†¡ ì˜¤ë¥˜ ë°œìƒ"; }
    }

    async function render(file, type, dy, n, p) {
        const cvs = $('canvas');
        const pdf = await pdfjsLib.getDocument({ data: await file.arrayBuffer() }).promise;
        const pg = await pdf.getPage(1);
        const vp = pg.getViewport({ scale: 2.0 });
        const ctx = cvs.getContext('2d');
        cvs.width = vp.width; cvs.height = vp.height;
        ctx.fillStyle = "#fff"; ctx.fillRect(0,0,cvs.width,cvs.height);
        await pg.render({ canvasContext: ctx, viewport: vp }).promise;
        
        const s = 2.0, h = vp.height;
        const dr = (t, x, y, sz=13) => { ctx.font=`${sz*s}px 'Malgun Gothic'`; ctx.fillStyle="#000"; ctx.fillText(t,x*s,h-(y*s)); };
        const ck = (x, y) => { ctx.font=`bold ${22*s}px Arial`; ctx.fillStyle="red"; ctx.textAlign="center"; ctx.fillText("v",x*s,h-(y*s)); ctx.textAlign="start"; };

        if(type === "ê³ ") {
            [612,579,548,504,445,385,340,310,273].forEach(y => ck(500,y));
            dr(dy.y,199,209); dr(dy.m,230,209); dr(dy.day,256,209); dr(n,431,209); dr(n,500,209);
            dr(dy.y,200,96); dr(dy.m,225,96); dr(dy.day,250,96); dr(p,430,96); dr(p,505,96);
        } else if(type === "ë™") {
            [640,545,428,310,234].forEach(y => ck(522,y));
            dr(dy.y,254,138); dr(dy.m,300,138); dr(dy.day,341,138); dr(n,150,107); dr(n,239,107);
            dr("ë¯¸ë˜ì „ëµì‚¬ì—…ë‹¨",150,58); dr(p,416,64); dr(p,500,64);
        } else if(type === "ë¹„") {
            // ë¹„êµí™•ì¸ì•ˆë‚´ì„œìš© ì¢Œí‘œ (ì¤€ë¹„ ì¤‘ - í˜„ì¬ëŠ” í•˜ë‹¨ì— ê¸°ë³¸ ì •ë³´ë§Œ ì¶œë ¥)
            dr(`${dy.y}ë…„ ${dy.m}ì›” ${dy.day}ì¼`, 300, 50, 15);
            dr(n, 500, 50, 15);
            dr(p, 100, 50, 15);
        }
        return cvs.toDataURL('image/jpeg', 0.9);
    }

    window.onload = () => {
        updateClock(); setInterval(updateClock, 1000);
        fetchWeather(); setInterval(fetchWeather, 1800000);
        drawCal();
    };
</script>
</body>
</html>
